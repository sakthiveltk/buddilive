<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	                    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

	<changeSet id="create users" author="wyatt">
		<createTable tableName="users">
			<column name="id" type="int">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_users_id"/>
			</column>
			<column name="uuid" type="varchar(64)">
				<constraints nullable="false" unique="true" uniqueConstraintName="uc_users_uuid"/>
			</column>
			<column name="identifier" type="varchar(64)">		<!-- An SHA1 hash of the login email -->
				<constraints nullable="false" unique="true" uniqueConstraintName="uc_users_identifier"/>
			</column>
			<column name="credentials" type="varchar(64)">
				<constraints nullable="false"/>
			</column>
			<column name="email" type="varchar(255)"/>		<!-- An optional, recoverable, email address used for communication with the user -->
			<column name="premium" type="char(1)" defaultValue="N">
				<constraints nullable="false"/>
			</column>
			<column name="created" type="timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="modified" type="timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="create sources" author="wyatt">
		<createTable tableName="sources">
			<column name="id" type="int">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_sources_id"/>
			</column>
			<column name="users" type="int">
				<constraints  nullable="false" foreignKeyName="pk_users_id" deleteCascade="true"/>
			</column>
			<column name="uuid" type="varchar(64)">
				<constraints nullable="false" unique="true" uniqueConstraintName="uc_sources_uuid"/>
			</column>
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="start_date" type="date">
				<constraints nullable="false"/>
			</column>
			<column name="deleted" type="char(1)" defaultValue="N"/>
			<column name="created" type="timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="modified" type="timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="type" type="char(1)">	<!-- One of 'D'ebit, 'C'redit, 'I'ncome, 'E'xpense -->
				<constraints nullable="false"/>
			</column>

			
			<!-- The following are only for accounts -->
			<column name="start_balance" type="currency">
				<constraints nullable="false"/>
			</column>
			
			<!-- The following are only for categories -->
			<column name="period_type" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="parent" type="int">
				<constraints foreignKeyName="pk_source_id" />
			</column>
		</createTable>
	</changeSet>
	
	<changeSet id="create transactions" author="wyatt">
		<createTable tableName="transactions">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_parent_transaction_id"/>
			</column>
			<column name="uuid" type="varchar(64)">
				<constraints nullable="false" unique="true" uniqueConstraintName="uc_parent_transaction_uuid"/>
			</column>
			<column name="users" type="int">
				<constraints nullable="false" foreignKeyName="pk_users_id" deleteCascade="true"/>
			</column>
			<column name="description" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="number" type="varchar(255)"/>
			<column name="date" type="date">
				<constraints nullable="false"/>
			</column>

			<column name="deleted" type="char(1)" defaultValue="N">
				<constraints nullable="false"/>
			</column>
			<column name="created" type="timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="modified" type="timestamp">
				<constraints nullable="false"/>
			</column>

		</createTable>
	</changeSet>
	
	<changeSet id="create splits" author="wyatt">
		<createTable tableName="splits">
			<column name="id" type="bigint">
				<constraints primaryKey="true" nullable="false" primaryKeyName="pk_transaction_component_id"/>
			</column>
			<column name="parent_transaction" type="bigint">
				<constraints nullable="false" foreignKeyName="pk_parent_transaction_id" deleteCascade="true"/>
			</column>
			<column name="amount" type="currency">
				<constraints nullable="false"/>
			</column>
			<column name="from_source" type="int">
				<constraints nullable="false" foreignKeyName="pk_sources_id" deleteCascade="true"/>
			</column>
			<column name="to_source" type="int">
				<constraints nullable="false" foreignKeyName="pk_sources_id" deleteCascade="true"/>
			</column>
			<column name="memo" type="varchar(1024)"/>
			<column name="deleted" type="char(1)" defaultValue="N">
				<constraints nullable="false"/>
			</column>
			<column name="created" type="timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="modified" type="timestamp">
				<constraints nullable="false"/>
			</column>

		</createTable>
	</changeSet>
	
	<changeSet id="populate users" author="wyatt" context="sample">
		<insert tableName="users">
			<column name="id" valueNumeric="0"/>
			<column name="identifier" value="SHA1:751a224fbc239d09e95e7caad9bcd339bc46164a"/> <!-- admin@digitalcave.ca, no salt -->
			<column name="credentials" value="SHA1:ebe56a2da75740d421c78c6b6c998820b4dfd52d64eaa9e4"/> <!-- ActivityChooses72Things, random salt -->
			<column name="uuid" value="0"/>
			<column name="created" valueDate="current_timestamp"/>
			<column name="modified" valueDate="current_timestamp"/>
		</insert>
	</changeSet>

</databaseChangeLog>